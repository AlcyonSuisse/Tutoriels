# Docker compose
Docker compose est un outil anciennement tiers puis racheté par docker, qui permet de composer une stack ou une infrastructure complète de conteneurs.
Celui ci permet de simplifier la création, l'inter-connexion et la multiplication de conteneurs. En gros nous créons un fichier yml qui nous permettra de gérer un ensemble de conteneurs en quelques commandes.

Maintenant de vous connaissez bien docker (Si j'ai bien fait mon boulot), je serais plus succinct sur les explications, surtout que docker-compose reprends les mêmes options que docker.

## Installation

### Sous windows
Si vous avez installé docker via docker-toolbox ou docker4windows, docker-compose est déjà installé et fonctionnel.

Sinon nous pouvons l'installer à la main, il suffit de télécharger le binaire sur [github](https://github.com/docker/compose/releases)
Example pour la version 1.8.1 (dernière version présentement) [docker-compose](https://github.com/docker/compose/releases/download/1.8.1/docker-compose-Windows-x86_64.exe)

Si vous avez installé docker en suivant la méthode manuel de se tutoriel, vous devriez avoir un répertoire c:\docker\bin, copier y le binaire et renommer le en docker-compose.exe.

Et c'est tout, normalement tout est ok, on peux tester :
```powershell
PS P:\> docker-compose version
docker-compose version 1.8.0, build d988a55
docker-py version: 1.9.0
CPython version: 2.7.11
OpenSSL version: OpenSSL 1.0.2d 9 Jul 2015
```

### Sous GNU/Linux
Nous avons 3 possibilités d'installer docker-compose sous GNU/Linux, avec pip, à la main, ou avec un conteneur. Nous ne verrons ici que l'installation via pip, et l'installation via un container. Je vous conseille tout de même l'installation par conteneur, plus simple et plus rapide a mettre à jour.

#### Installation via pip
Pour ceux qui ne connaissent pas pip, pip est un gestionnaire de paquet pour python, qui permet l'installation d'application, ou de librairie. C'est un peu comme apt-get.

On installe d'abord pip, sous debian cela donne :
```shell
$ apt-get install python-pip
Lecture des listes de paquets... Fait
Construction de l'arbre des dépendances
Lecture des informations d'état... Fait
python-pip est déjà la plus récente version disponible.
0 mis à jour, 0 nouvellement installés, 0 à enlever et 0 non mis à jour.
```
*(de mon coté j'avais déjà installé pip)*

Il suffit maintenant de lancer cette commande :
```shell
$ pip install docker-compose
```

On peux tester :
```shell
$ docker-compose version
docker-compose version 1.8.0, build d988a55
docker-py version: 1.9.0
CPython version: 2.7.11
OpenSSL version: OpenSSL 1.0.2d 9 Jul 2015
```

#### Installation par un conteneur
C'est vraiment très simple, nous allons créer un alias qui lancera un conteneur docker-compose.
Nous utiliserons ma propre image : [xataz/compose](https://hub.docker.com/r/xataz/compose/)

On édite le fichier .profile de notre utilisateur :
```shell
$ vim ~/.profile
```

Et on ajoute ceci dedans :
```shell
alias docker-compose='docker run -v "$(pwd)":"$(pwd)" \
        -v /var/run/docker.sock:/var/run/docker.sock \
        -e UID=$(id -u) -e GID=$(id -g) \
        -w "$(pwd)" \
        -ti --rm xataz/compose:1.8'
```

On recharge le profile :
```shell
$ . ~/.profile
```

Et on peut faire un essai :
```shell
$ docker-compose version
Unable to find image 'xataz/compose:1.8' locally
1.8: Pulling from xataz/compose
c0cb142e4345: Already exists
a0bbf809363b: Pull complete
6d4c02e2941c: Pull complete
Digest: sha256:8a56828af12467a6f7ac55c54d6dd877d51e50026ff91d9fc88d0d0cedbadb3f
Status: Downloaded newer image for xataz/compose:1.8
docker-compose version 1.8.1, build 878cff1
docker-py version: 1.10.3
CPython version: 2.7.12
OpenSSL version: OpenSSL 1.0.2i  22 Sep 2016
```

### Sous MacOS